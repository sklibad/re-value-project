<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin=""/>
    <link rel="stylesheet" href="src/leaflet.legend.css" />
    <link rel="stylesheet" href="map1.css" />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <script src="Control.FullScreen.js"></script>
    <script src="map1.js" type="text/javascript"></script>
    <script type="text/javascript" src="src/leaflet.legend.js"></script>
    <title>Map1</title>
</head>
<body>
    <div id='map'></div>
    <script type="text/javascript">
        var map = L.map('map', {
            fullscreenControl: true,
            fullscreenControlOptions: {
                title: "Show me the fullscreen !",
                titleCancel: "Exit fullscreen mode"
            }
        }).setView([62.62357822995269, 6.568337702605886], 9);
    
        var OSmap = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> | <a href="https://www.linkedin.com/in/david-skliba/?locale=en_US" target="_blank">David Šklíba</a>',
            opacity: 1
        }).addTo(map);

        var Imagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 19,
            attribution:'&copy; <a href="https://www.arcgis.com/home/item.html?id=10df2279f9684e4a9f6a7f08febac2a9" target="_blank">ESRI</a> | <a href="https://www.linkedin.com/in/david-skliba/?locale=en_US" target="_blank">David Šklíba</a>',
            opacity: 1
        });

        var TopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution:'&copy; <a href = "https://opentopomap.org/credits" target = "_blank">OpenTopoMap</a> | <a href="https://www.linkedin.com/in/david-skliba/?locale=en_US" target="_blank">David Šklíba</a>',
            opacity: 0.5
        });

        var baseLayers = {
            "OS Map": OSmap,
            "Imagery": Imagery,
            "TopoMap": TopoMap
        };

        var alesund = L.geoJSON(alesund, {
            style: function (feature) {
                return {
                    fillColor: "#C0C0C0",
                    fillOpacity: 0,
                    color: '#808080',
                    weight: 3
                };
            }
        });

        var bruges = L.geoJSON(bruges, {
            style: function (feature) {
                return {
                    fillColor: "#C0C0C0",
                    fillOpacity: 0,
                    color: '#808080',
                    weight: 3
                };
            }
        });

        var burgas = L.geoJSON(burgas, {
            style: function (feature) {
                return {
                    fillColor: "#C0C0C0",
                    fillOpacity: 0,
                    color: '#808080',
                    weight: 3
                };
            }
        });

        var cascais = L.geoJSON(cascais, {
            style: function (feature) {
                return {
                    fillColor: "#C0C0C0",
                    fillOpacity: 0,
                    color: '#808080',
                    weight: 3
                };
            }
        });

        var constanta = L.geoJSON(constanta, {
            style: function (feature) {
                return {
                    fillColor: "#C0C0C0",
                    fillOpacity: 0,
                    color: '#808080',
                    weight: 3
                };
            }
        });

        var izmir = L.geoJSON(izmir, {
            style: function (feature) {
                return {
                    fillColor: "#C0C0C0",
                    fillOpacity: 0,
                    color: '#808080',
                    weight: 3
                };
            }
        });

        var pisek = L.geoJSON(pisek, {
            style: function (feature) {
                return {
                    fillColor: "#C0C0C0",
                    fillOpacity: 0,
                    color: '#808080',
                    weight: 3
                };
            }
        });

        var rijeka = L.geoJSON(rijeka, {
            style: function (feature) {
                return {
                    fillColor: "#C0C0C0",
                    fillOpacity: 0,
                    color: '#808080',
                    weight: 3
                };
            }
        });

        var rimini = L.geoJSON(rimini, {
            style: function (feature) {
                return {
                    fillColor: "#C0C0C0",
                    fillOpacity: 0,
                    color: '#808080',
                    weight: 3
                };
            }
        });

        var overlayLayers = {
            "Alesund": alesund,
            "Cascais": cascais,
            "Bruges": bruges,
            "Burgas": burgas,
            "Constanta": constanta,
            "Izmir": izmir,
            "Pisek": pisek,
            "Rijeka": rijeka,
            "Rimini": rimini
        };

        // Add the initial radio button layer
        overlayLayers[Object.keys(overlayLayers)[0]].addTo(map);
        console.log("adding first overlay layer by default to map")

        // Define the dictionary for coordinates and zoom levels
        var layerViewSettings = {
            "Alesund": { center: [62.62357822995269, 6.568337702605886], zoom: 9 },
            "Cascais": { center: [38.7246415419252, -9.398661627395064], zoom: 12 },
            "Bruges": { center: [51.26277668564624, 3.2157520267962854], zoom: 11 },
            "Burgas": { center: [42.52365465796975, 27.412133356605594], zoom: 10 },
            "Constanta": { center: [44.18397145865716, 28.595090491839358], zoom: 11 },
            "Izmir": { center: [38.60497560030166, 27.446486886485193], zoom: 8 },
            "Pisek": { center: [49.28765927177321, 14.167823590584321], zoom: 12 },
            "Rijeka": { center: [44.97243541294297, 14.623684506249385], zoom: 8 },
            "Rimini": { center: [43.96190532408524, 12.423399060233246], zoom: 10 }
            // Add other layers' view settings here
        };

        async function loadExtents(layerName) {
            const response = await fetch(`${layerName}/extents.json`);
            const extents = await response.json();
            return extents;
        }

        async function updateDropdownLayers(layerName) {
            const extents = await loadExtents(layerName);
            const basePath = `${layerName}/png/`;
            dropdownLayers = {};

            for (const [key, value] of Object.entries(extents)) {
                console.log(key)
                const imageUrl = `${basePath}${key}.png`;
                const imageBounds = value;
                console.log(imageBounds)
                const imageLayer = L.imageOverlay(imageUrl, imageBounds);
                dropdownLayers[key] = imageLayer;
            }

            // Update dropdown menu
            const dropdown = document.getElementById('dropdownLayer');
            dropdown.innerHTML = '<option value="">Select a layer</option>';

            for (const layer in dropdownLayers) {
                const option = document.createElement('option');
                option.value = layer;
                option.textContent = layer;
                dropdown.appendChild(option);
            }
        }

        var dropdownLayers = {};
        updateDropdownLayers(Object.keys(overlayLayers)[0])

        var overlayControl = L.control({ position: 'topright' });

        overlayControl.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend');
            
            // Add a white background with padding and border
            div.style.backgroundColor = 'white';
            div.style.padding = '10px';
            div.style.border = '2px solid #ccc';
            div.style.borderRadius = '5px';

            // Create radio button section
            for (var i = 0; i < Object.keys(overlayLayers).length; i++) {
                var layerName = Object.keys(overlayLayers)[i];
                var checkedAttribute = i === 0 ? 'checked' : '';  // Add 'checked' for the first layer

                div.innerHTML +=
                    '<input type="radio" name="layer" value="' + layerName + '" id="' + layerName + '" ' + checkedAttribute +
                    ' title="Switch to ' + layerName + '">' +
                    '<label for="' + layerName + '" title="Switch to ' + layerName + '">' + layerName + '</label><br>';
            }
            
            // Create dropdown menu section
            div.innerHTML += '<br><label for="dropdownLayer">Additional Layers:</label><br>';
            var select = L.DomUtil.create('select', '', div);
            select.id = 'dropdownLayer';

            var defaultOption = L.DomUtil.create('option', '', select);
            defaultOption.value = "";
            defaultOption.text = "Select a layer";
            
            for (var layerName in dropdownLayers) {
                if (dropdownLayers.hasOwnProperty(layerName)) {
                    var option = L.DomUtil.create('option', '', select);
                    option.value = layerName;
                    option.text = layerName;
                }
            }

            div.addEventListener('change', function (e) {
                var selectedLayer = e.target.value;

                // Handle dropdown change
                if (e.target.id === 'dropdownLayer') {
                    // Remove all dropdown layers
                    for (var layerName in dropdownLayers) {
                        if (dropdownLayers.hasOwnProperty(layerName)) {
                            map.removeLayer(dropdownLayers[layerName]);
                        }
                    }
                    // Add the selected dropdown layer
                    if (dropdownLayers[selectedLayer]) {
                        dropdownLayers[selectedLayer].addTo(map);
                        console.log("adding dropdown layer to the map")
                    }
                }

                // Handle radio button change
                if (e.target.name === 'layer') {
                    for (var layerName in overlayLayers) {
                        if (overlayLayers.hasOwnProperty(layerName) && layerName !== selectedLayer) {
                            map.removeLayer(overlayLayers[layerName]);
                        }
                    }
                    overlayLayers[selectedLayer].addTo(map);
                    console.log("adding overlay layer to map")

                    // Set the map view based on the selected layer
                    if (layerViewSettings[selectedLayer]) {
                        map.setView(layerViewSettings[selectedLayer].center, layerViewSettings[selectedLayer].zoom);
                    }

                    // Update dropdown layers
                    updateDropdownLayers(selectedLayer);
                }
            });

            return div;
        };

        L.control.layers(baseLayers).addTo(map);

        // Add the custom control to the map
        overlayControl.addTo(map);
    </script>
</body>
</html>
